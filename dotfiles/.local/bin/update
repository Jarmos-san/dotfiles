#!/usr/bin/env python3

###############################################################################
# Simple script to make running updates aacrsso different easy peasy!
#
# Author: Somraj Saha <somraj.saha@jarmos.dev>
# License: MIT (see the LICENSE document for more info on this regards)
###############################################################################

import platform
import subprocess
import sys

# Message labels with their respective colour codes
_RESET = "\x1b[0m"
_BLUE = "\x1b[94m"
_GREEN = "\x1b[92m"
# _YELLOW = "\x1b[93m"
# _WARN = f"[{_YELLOW}WARN{_RESET}]"
_RED = "\x1b[31m"
_INFO = f"[{_BLUE}INFO{_RESET}]"
_SUCCESS = f"[{_GREEN}SUCCESS{_RESET}]"
_ERROR = f"[{_RED}ERROR{_RESET}]"


def run_linux_updates() -> None:
    """Detect the Linux distribution and run system updates accordingly.

    Supported distributions:
      - Ubuntu (apt-get)
      - Debian (apt-get)
      - Fedora (dnf)

    This function executes the appropriate package manager commands for
    updating system packages and removing unused dependencies. It uses
    `subprocess.run(..., check=True)` to ensure errors are surfaced.

    If the distribution is not recognized, the function logs an error
    and terminates the program with a non-zero exit code.
    """
    distro = platform.freedesktop_os_release().get("NAME", "")

    match distro:
        case "Ubuntu" | "Debian":
            print(f"{_INFO} Updating {distro} system...")
            subprocess.run(["sudo", "apt-get", "update"], check=True)
            subprocess.run(["sudo", "apt-get", "upgrade", "--yes"], check=True)
            subprocess.run(
                ["sudo", "apt-get", "autoremove", "--purge", "--yes"], check=True
            )
            print(f"{_INFO} {distro} APT packages upgrade complete!")
        case "Fedora":
            print(f"{_INFO} Updating {distro} system...")
            subprocess.run(["sudo", "dnf", "upgrade", "--assumeyes"], check=True)
            subprocess.run(["sudo", "dnf", "autoremove", "--assumeyes"], check=True)
            print(f"{_INFO} {distro} APT packages upgrade complete!")
        case _:
            print(f"{_ERROR} Failed to identify system information...exiting!")
            sys.exit(1)


def run_homebrew_updates() -> None:
    """Run updates for the Homebrew package manager."""


def run_zsh_updates() -> None:
    """Update the ZSH plugins."""


def main() -> None:
    """Entrypoint of the script."""
    run_linux_updates()
    run_homebrew_updates()

    print(f"{_SUCCESS} System update complete...exiting now")


if __name__ == "__main__":
    main()
